# FER 分辨率与蒙特卡洛帧数分析

## 现象描述

在两次 Turbo 码仿真实验中观察到以下现象：

| 实验 | 总帧数设置 | 高 SNR 点 (0.9-1.0 dB) 的 Frame Errors |
|------|-----------|----------------------------------------|
| 153953 | 20,000 | 1 |
| 163512 | 50,000 | 1 |

两次实验在高 SNR 端（0.9 dB 和 1.0 dB）的 **Frame Errors 都恰好等于 1**，导致：
- 实验1：FER = 1/20000 = 5×10⁻⁵
- 实验2：FER = 1/50000 = 2×10⁻⁵

用户提到当 Frame = 2 或 1 时，4 dB 处的 FER = 0。

---

## 核心原理：FER 分辨率极限

### 1. FER 的统计学本质

FER (Frame Error Rate) 定义为：

$$
\text{FER} = \frac{\text{错误帧数}}{\text{总仿真帧数}} = \frac{N_{\text{error}}}{N_{\text{total}}}
$$

这是一个**离散的估计值**，其可检测的最小非零 FER 由总帧数决定：

$$
\text{FER}_{\min} = \frac{1}{N_{\text{total}}}
$$

### 2. 分辨率极限表

| 总帧数 $N_{\text{total}}$ | 最小可检测 FER | 可区分的 FER 等级数 |
|---------------------------|----------------|---------------------|
| 1 | 1 或 0 | 2 |
| 2 | 0.5 | 3 |
| 100 | 0.01 | 101 |
| 1,000 | 10⁻³ | 1,001 |
| 20,000 | 5×10⁻⁵ | 20,001 |
| 50,000 | 2×10⁻⁵ | 50,001 |
| 100,000 | 10⁻⁵ | 100,001 |

### 3. 量化边界条件

当真实 FER < FER_min 时：

- **高概率事件**：仿真中观测到 0 个错误帧 → 报告 FER = 0
- **低概率事件**：偶然观测到 1 个错误帧 → 报告 FER = FER_min

这就是您观察到的现象：
- Frame = 1 或 2 时在 4 dB 观测 FER = 0（真实 FER << 0.5，未触发错误）
- Frame = 20000/50000 时在高 SNR 仍观测到 Frame_Errors = 1（随机触发了一次错误）

---

## 实验数据分析

### 实验 1 (153953_merged.csv)

```
Eb/N0    Frame_Errors   Total_Frames    FER
0.9      1              20000           5.000000e-05
1.0      1              20000           5.000000e-05
```

### 实验 2 (163512_merged.csv)

```
Eb/N0    Frame_Errors   Total_Frames    FER
0.9      1              50000           2.000000e-05
1.0      1              50000           2.000000e-05
```

### 现象解读

1. **Frame_Errors = 1 并非巧合**：
   - 仿真采用 Early Termination 策略，当收集到足够错误帧时可提前终止
   - 在高 SNR 区域，错误极为罕见，即使跑完全部帧也只能偶然捕获 0~2 个错误

2. **两个实验的 FER 差异**：
   - 实验1 FER = 5×10⁻⁵，实验2 FER = 2×10⁻⁵
   - 差异完全由分母（总帧数）决定，不代表性能变化

3. **统计置信度问题**：
   - 单个错误事件的 FER 估计极不可靠
   - 95% 置信区间极大（例如 1/20000 的置信区间约为 [2.5×10⁻⁶, 2.8×10⁻⁴]）

---

## 为什么 Frame = 2 或 1 时 4 dB 的 FER = 0

### 概率分析

假设真实 FER = 10⁻⁶（在 4 dB 左右的典型值），则：

| 帧数 | 观测到 0 错误帧的概率 | 观测到 ≥1 错误帧的概率 |
|-----|----------------------|------------------------|
| 1 | 0.999999 | 0.000001 |
| 2 | 0.999998 | 0.000002 |
| 1000 | 0.999 | 0.001 |
| 10,000 | 0.99 | 0.01 |
| 100,000 | 0.905 | 0.095 |
| 1,000,000 | 0.368 | 0.632 |

**结论**：使用极少帧数几乎必然观测到 FER = 0，这不代表性能好，而是**采样不足**。

---

## 工程建议

### 1. 帧数选择准则

为获得统计可靠的 FER 估计，应满足：

$$
N_{\text{total}} \geq \frac{k}{\text{Target FER}}
$$

其中 $k$ 是期望收集的最小错误帧数（通常 $k = 100$ 或更多）。

| 目标 FER | 最少帧数 (k=100) |
|----------|------------------|
| 10⁻² | 10,000 |
| 10⁻³ | 100,000 |
| 10⁻⁴ | 1,000,000 |
| 10⁻⁵ | 10,000,000 |

### 2. 当前仿真代码的 Early Termination 逻辑

```c
// sim_runner.c 中的实现
const long MIN_FRAME_ERRORS = 100;

// Early termination: stop if we have enough frame errors
if (frame_error >= MIN_FRAME_ERRORS && seq >= 1000) {
    break;
}
```

此逻辑保证：
- 在高错误率区域快速终止（收集 100 个错误帧后停止）
- 在低错误率区域运行完所有帧
- 平衡了仿真时间和统计精度

### 3. 结果解读最佳实践

| 错误帧数 | 置信度评估 | 建议 |
|---------|-----------|------|
| > 100 | 良好 | 直接使用 |
| 10-100 | 中等 | 标注置信区间 |
| 1-10 | 较差 | 仅作参考，需增加帧数 |
| 0 | 无信息 | 报告为 "< FER_min" |

---

## 总结

| 问题 | 解释 |
|-----|------|
| 为什么两个实验最后的 Frame_Errors 都是 1？ | 高 SNR 区域真实 FER 极低，20000-50000 帧仅能捕获极少错误事件 |
| 为什么 Frame=2 或 1 时 FER=0？ | 帧数过少，真实错误概率极低，几乎不可能触发错误帧 |
| 这些 FER=5e-5 / 2e-5 可信吗？ | 统计置信度较低，仅表示 "FER 在此量级或更低" |
| 如何获得更准确的低 FER 估计？ | 大幅增加仿真帧数（百万级），或使用重要性采样等加速技术 |

---

## 附录：FER 置信区间估算

对于二项分布，当观测到 $k$ 个错误帧时，真实 FER 的 95% 置信区间可用 Clopper-Pearson 方法计算：

```
k = 1, n = 20000 → FER ∈ [1.26×10⁻⁶, 2.79×10⁻⁴]
k = 1, n = 50000 → FER ∈ [5.05×10⁻⁷, 1.11×10⁻⁴]
```

这表明单个错误事件的 FER 估计具有约 **两个数量级的不确定性**。
